{{define "share_album.html"}}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Album.Title}} - FamilyShare</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body>
    <a href="#main-content" class="skip-to-main">Skip to main content</a>

    <nav style="background: var(--color-gray-800); color: white; padding: var(--space-4);">
        <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; gap: var(--space-3);">
            <span style="font-size: 1.5rem;">ðŸ“¸</span>
            <h1 style="font-size: var(--font-size-lg); margin: 0;">FamilyShare</h1>
        </div>
    </nav>

    <main id="main-content" style="max-width: 1200px; margin: 0 auto; padding: var(--space-6);" x-data="photoGallery()">

        <header style="margin-bottom: var(--space-8); text-align: center;">
            <h1 style="font-size: var(--font-size-3xl); color: var(--color-gray-900); margin-bottom: var(--space-2);">
                {{.Album.Title}}
            </h1>
            {{if .Album.Description.Valid}}
            <p style="font-size: var(--font-size-lg); color: var(--color-gray-600); max-width: 600px; margin: 0 auto;">
                {{.Album.Description.String}}
            </p>
            {{end}}
            <p style="font-size: var(--font-size-sm); color: var(--color-gray-500); margin-top: var(--space-3);">
                ðŸ“· <span x-text="photos.length"></span> <span x-text="photos.length === 1 ? 'photo' : 'photos'"></span>
            </p>
        </header>

        {{if or .Photos .HasMore}}
        <section>
            <!-- Photo Grid Container -->
            <div id="photo-grid" class="grid-photos">
                {{range $index, $photo := .Photos}}
                <div class="card card-photo" data-photo-id="{{$photo.ID}}"
                    data-photo-url="/data/photos/{{$photo.ID}}.webp" data-photo-name="{{$photo.Filename}}">
                    <img src="/data/photos/{{$photo.ID}}.webp" alt="{{$photo.Filename}}" class="card-photo-preview"
                        loading="lazy" @click="openLightbox({{$index}})" style="cursor: pointer;">
                    <div class="card-photo-info">
                        <p class="text-xs text-muted mb-0">{{$photo.Filename}}</p>
                    </div>
                </div>
                {{end}}
            </div>

            <!-- Load More Button -->
            {{if .HasMore}}
            <div id="load-more-container" style="display: flex; justify-content: center; margin-top: var(--space-8);">
                <button class="btn btn-secondary" hx-get="/s/{{.Token}}?page={{.NextPage}}" hx-target="#photo-grid"
                    hx-swap="beforeend" hx-indicator="#loading-spinner" style="position: relative;">
                    <span id="load-more-text">Load More Photos</span>
                    <span id="loading-spinner" class="htmx-indicator" style="margin-left: var(--space-2);">
                        <span
                            style="display: inline-block; width: 1rem; height: 1rem; border: 2px solid currentColor; border-top-color: transparent; border-radius: 50%; animation: spin 0.6s linear infinite;"></span>
                    </span>
                </button>
            </div>
            {{end}}
        </section>
        {{else}}
        <div class="empty-state">
            <div class="empty-state-icon">ðŸ“·</div>
            <h3 class="empty-state-title">No Photos Yet</h3>
            <p class="empty-state-description">
                This album doesn't have any photos yet.
            </p>
        </div>
        {{end}}

        <!-- Photo Lightbox Modal with Carousel -->
        <div class="modal" x-show="lightboxOpen" @click.self="closeLightbox()" @keydown.escape.window="closeLightbox()"
            @keydown.arrow-left.window="prevPhoto()" @keydown.arrow-right.window="nextPhoto()" style="display: none;"
            x-cloak role="dialog" aria-modal="true" aria-label="Photo lightbox">
            <div class="modal-backdrop" @click="closeLightbox()" style="background: rgba(0, 0, 0, 0.95);"></div>
            <div style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 1001; padding: var(--space-4);"
                @click.stop>

                <!-- Close Button -->
                <button @click="closeLightbox()"
                    style="position: absolute; top: var(--space-4); right: var(--space-4); background: rgba(0, 0, 0, 0.7); color: white; border: none; font-size: 2rem; width: 3rem; height: 3rem; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 1002; transition: background var(--transition-fast);"
                    onmouseover="this.style.background='rgba(0, 0, 0, 0.9)'"
                    onmouseout="this.style.background='rgba(0, 0, 0, 0.7)'" title="Close (Esc)"
                    aria-label="Close lightbox">&times;</button>

                <!-- Previous Button -->
                <button @click="prevPhoto()" x-show="photos.length > 1"
                    style="position: absolute; left: var(--space-4); top: 50%; transform: translateY(-50%); background: rgba(0, 0, 0, 0.7); color: white; border: none; font-size: 3rem; width: 3.5rem; height: 3.5rem; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 1002; line-height: 1; padding: 0; transition: background var(--transition-fast);"
                    onmouseover="this.style.background='rgba(0, 0, 0, 0.9)'"
                    onmouseout="this.style.background='rgba(0, 0, 0, 0.7)'" title="Previous (â†)"
                    aria-label="Previous photo">&lsaquo;</button>

                <!-- Next Button -->
                <button @click="nextPhoto()" x-show="photos.length > 1"
                    style="position: absolute; right: var(--space-4); top: 50%; transform: translateY(-50%); background: rgba(0, 0, 0, 0.7); color: white; border: none; font-size: 3rem; width: 3.5rem; height: 3.5rem; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 1002; line-height: 1; padding: 0; transition: background var(--transition-fast);"
                    onmouseover="this.style.background='rgba(0, 0, 0, 0.9)'"
                    onmouseout="this.style.background='rgba(0, 0, 0, 0.7)'" title="Next (â†’)"
                    aria-label="Next photo">&rsaquo;</button>

                <div style="max-width: 95vw; max-height: 95vh; display: flex; flex-direction: column; align-items: center;"
                    @click.stop>
                    <img :src="currentPhoto.url" :alt="currentPhoto.name"
                        style="max-width: 100%; max-height: 90vh; object-fit: contain; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-xl);">
                    <div
                        style="color: white; margin-top: var(--space-4); font-size: var(--font-size-sm); background: rgba(0, 0, 0, 0.7); padding: var(--space-2) var(--space-4); border-radius: var(--border-radius); display: flex; align-items: center; gap: var(--space-3);">
                        <p x-text="currentPhoto.name" style="margin: 0;"></p>
                        <span x-show="photos.length > 1" x-text="`${currentIndex + 1} / ${photos.length}`"
                            style="opacity: 0.7;"></span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer
        style="background: var(--color-gray-100); padding: var(--space-6); margin-top: var(--space-12); text-align: center;">
        <p style="color: var(--color-gray-600); font-size: var(--font-size-sm); margin: 0;">
            Shared via FamilyShare ðŸ“¸
        </p>
    </footer>

    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .htmx-indicator {
            display: none;
        }

        .htmx-request .htmx-indicator {
            display: inline-block;
        }

        .htmx-request #load-more-text {
            opacity: 0.6;
        }
    </style>

    <script>
        function photoGallery() {
            return {
                lightboxOpen: false,
                currentIndex: 0,
                photos: [],

                init() {
                    // Initialize photos array from DOM
                    this.updatePhotosFromDOM();

                    // Re-index photos when HTMX loads more
                    document.body.addEventListener('htmx:afterSwap', () => {
                        this.updatePhotosFromDOM();
                    });
                },

                updatePhotosFromDOM() {
                    const photoCards = document.querySelectorAll('[data-photo-id]');
                    this.photos = Array.from(photoCards).map((card, index) => ({
                        id: card.dataset.photoId,
                        url: card.dataset.photoUrl,
                        name: card.dataset.photoName,
                        index: index
                    }));
                },

                get currentPhoto() {
                    return this.photos[this.currentIndex] || { url: '', name: '', id: '' };
                },

                openLightbox(index) {
                    this.currentIndex = index;
                    this.lightboxOpen = true;
                    document.body.style.overflow = 'hidden';
                },

                closeLightbox() {
                    this.lightboxOpen = false;
                    document.body.style.overflow = '';
                },

                nextPhoto() {
                    if (!this.lightboxOpen || this.photos.length === 0) return;
                    this.currentIndex = (this.currentIndex + 1) % this.photos.length;
                },

                prevPhoto() {
                    if (!this.lightboxOpen || this.photos.length === 0) return;
                    this.currentIndex = (this.currentIndex - 1 + this.photos.length) % this.photos.length;
                }
            }
        }
    </script>
</body>

</html>
{{end}}